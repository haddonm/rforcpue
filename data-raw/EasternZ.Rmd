---
title: "Do abalone catch-rates reflect relative abundance through time?"
author: "Craig Mundy and Malcolm Haddon"
date: "`r format(Sys.time(), '%d&period; %B %Y')`"
output: 
    word_document:
      reference_docx:  C:\Users\User\Dropbox\A_Book\book\trialreferencestyle.docx
      toc: true
      toc_depth: 3
      fig_caption: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE)

options(knitr.kable.NA = "",
        knitr.table.format = "pandoc")

if (dir.exists("C:/Users/Malcolm/Dropbox")) {
  ddir <- "C:/Users/Malcolm/Dropbox"
} else {
  ddir <- "C:/Users/User/Dropbox"
}
datadir <- paste0(ddir,"/","AbaloneData")

wkdir <- "./../../manuscripts/abalonecpue/"
rawdir <- paste0(ddir,"/rcode2/rforcpue/data-raw/")

options("show.signif.stars"=FALSE,"stringsAsFactors"=FALSE,
        "max.print"=50000,"width"=240)

library(rutilsMH)
suppressPackageStartupMessages(library(knitr))
library(captioner)
library(rforcpue)    # https://github.com/haddonm

tab_nums <- captioner(prefix = "Table")
fig_nums <- captioner(prefix = "Figure")
equ_nums <- captioner(prefix = "Equ.")

#source(file.path("./../../A_Book/book/Rcpp_functions.R"))

```



# Do abalone catch-rates reflect relative abundance through time?

Craig Mundy$^{1}$ and Malcolm Haddon$^{1,2}$

1. Institute of Marine and Antarctic Science, University of Tasmania, P.O. Box 49, Hobart, Tasmania, Australia

2. CSIRO Oceans and Atmosphere, GPO Box 1538, Hobart, TAS 7001, Australia


# Abstract



# Objective(s)

The intent of this outline manuscript is to begin to piece together analysis of the validity of using cpue with wild caught abalone. This is a synthesis of discussions about this subject that you and I started a couple of times but never really took anywhere. Its importance lies in the fact that all Australian abalone harvest strategies are empirical and use catch-rates of some kind (surveys are catch-rates).

# Introduction

Australia still has a number of wild abalone fisheries but, as with all abalone fisheries, their management remains difficult for many reasons the most important of which is the complex spatial structure exhibited by the biological properties at different locations. This spatial structure influences the productivity of different reefs and the size structure of the abalone typically caught in different locations.

The patchiness that is typical in abalone fisheries also influences observed catch-rates, and all Australian abalone fisheries use catch-rates of one kind or another in their harvest strategies, even where the harvest strategy is informal. This work aims to examine the validity of using abalone catch-rates in an important part of the Tasmanian fishery, which remains one of the largest in the world in terms of yield. 

Despite their on-going use, abalone catch-rates have a bad reputation and are considered unreliable because they are generally considered to suffer from hyper-stability, with a consequent risk of serial depletion of patches of abalone along a coast. The mis-match between the reputation of abalone catch-rates and their continued use in practice means that a closer examination of significant current abalone fisheries may illuminate under what circumstances catch-rates can be useful and when they should not be trusted.

An examination of whether abalone catch-rates can be used as a valid foundation of processes to provide management advice entails examining how well the current conceptual framework used to describe catch-rates matches the reality of the operation of abalone fisheries. The primary assumption when using catch-rates from commercial fisheries is that they provide a valid measure of the relative abundance of exploitable biomass. As a relative measure they are only potentially useful given a time-series of estimates.

Another major assumption behind the notion that catch-rates (cpue) provide a measure of relative abundance is that the members of stock constitute a dynamic-pool of individuals. The dynamic-pool assumption is fundamentally about the mixing rate within a population and implies that fishing mortality (or some other process) applied in one part of a fishery will influence all other parts of the fishery within a short period of time. With Tasmanian blacklip abalone (_Haliotis rubra_) the mixing rate is very local and very low (Miller _et al_, 2009) and seriously breaks the dynamic pool assumption that is a part of so much of fisheries science theory. This affects the potential relationship between observed catch-rates and relative abundance in terms of what is termed the 'catchability'. Catchability is usually defined as the proportion of the exploitable biomass taken by one unit of effort.

$$I_t=qB^E_t$$
where $I_t$ is the cpue during time $t$, $B^E_t$ is the average exploitable biomass available during time $t$, and $q$ is the catchability for a given fishing method (this cold also be given a time subscript). With the complex spatial exhibited by abalone populations the problem lies with the notion of available exploitable biomass. With highly mixed scale-fisheries estimates of $q$ are invariably very small numbers. However, an abalone diver operating on a particular reef could take an appreciable proportion of all legal sized abalone so $q$ could easily be or the order of 0.5 or higher. Generally the fishery operates at such small scales whereas the assessment and management tends to operate at larger scales.  



# Methods

We need to obtain unambivalent tables of the TACs for the main zones, the expected catch by block/zone for the main zones (or all zones), and the reported catches by block/zone. The docket datasets do not contain records for the Central-West Zone and the Bass Strait zone catches seem to be double the TAC (is that greenlip?).

Nevertheless, the eastern zone catch time-series closely matches the annual TAC since the advent of the zone in 2000 so we will examine that.

# Results

First: select the data to be used in the standardizations
* explain why data selection is necessary, although one sensiivity is to conduct the standardization without data selection (other than Eastern zone and years)
* Select the eastern zone from 1992 - 2019 (28 years)
* select the statistical blocks with workable numbers of records and complete catch time-series
* select positive catches and effort but remove remarkable outlying records (e.g. 1300 hours of effort in a day) 
* select divers that have operated in the fishery for more than single years.
* remove very small catch rates and very large catch rates

Second:
Demonstrate that the same cpue can be obtained despite taking very different levels of catch using whole of zone standardization, which confirms that cpue is not a reliable index of relative abundance over long time-periods (periods longer than 10 years?)

Third:
Demonstrate that essentially the same cpue trend can be obtained from southern statistical blocks as exhibited in northern statistical blocks within the eastern zone, which confirms that cpue is providing a consistent signal about some aspect of the dynamics of the fishery across a large geographical scale. Note that the absolute cpue differs by statistical block but the trends follow the same trajectory.

Fourth:
Domonstrate that fisheries that use an enforcible LML will exhibit a time-lag between management intervention and cpue changes, which will require use of a model of dynamics to illustrate the time-lags in growth are appreciable.


The data.frame _ab_ contains all available docket data with no filtering except to select the years to be considered (we omit any 2020 records). Total catches for any spatial configuration should use _ab_, but when estimating the mean cpue by year it is first necessary to do some data selection to avoid outliers and strange data.

```{r}
# First get the data
datafile <- paste0(datadir,"/CatchEffortData_2020-02-11.RData")
load(datafile)
ab <- abCEbl # simplify, simplify, simplify! Don't you just mean simplify?
columns <- colnames(ab) 
replace <- c("diver_id","fishing_date","fishyear","fishmonth","blockno",
             "subblockno","newzone","totalcatch","propblip",
             "entitlement.num","blprop.factor")
repwith <- c("diver","date","year","month","block","subblock","zone",
             "allcatch","pblip","entitle","percbl")
colnames(ab) <- tidynames(columns,replace,repwith)
pick <- which(ab[,"year"] > 2019) # lastyr set to 2019 to remove
ab <- droplevels(ab[-pick,])      # any 2020 records
dim(ab)
```

## Reported Catch vs TAC

```{r}
# catch by zone by year ----------------------------------------------
cbz <- tapply(ab$catch,list(ab$year,ab$zone),sum,na.rm=TRUE)/1000
label <- colnames(cbz)
cbzy <- cbind(as.numeric(rownames(cbz)),cbz)
colnames(cbzy) <- c("year",label)
kable(halftable(cbzy,yearcol="year",subdiv=2),digits=c(3,3,3,3,3,3,3,3))
tacs <- read.csv(file=paste0(rawdir,"abaloneTAC.csv"),header=TRUE)
```

```{r fig.width=6, fig.height=5}
plotprep(width=7,height=5,newdev=FALSE)
parset(plots=c(2,2),margin=c(0.45,0.45,0.05,0.1))
label <- colnames(cbz)
labtac <- c("BS","E","N","TotalW")
yrs <- as.numeric(rownames(cbz))
for (i in 1:4) { # i=1
  ymax <- getmax(c(cbz[,i],tacs[,labtac[i]]))
  plot(yrs,cbz[,i],type="l",lwd=2,ylab=label[i],ylim=c(0,ymax),
       panel.first=grid(),yaxs="i")
  abline(v=2000,lwd=1,col=1,lty=2)
  lines(tacs[,"year"],tacs[,labtac[i]],lwd=2,col=2)
}

```

In _CatchEffortData_2020-02-11.RData_, the _abCEbl_ data (designated _ab_ here) only includes zones BS, E, N, and W (ie no CW, damn nuisance though it is). The eastern zone obviously adheres very closely to the TAC. The northern zone less so, but recognizably close. The Bass Strait zone is very odd, and so is the western zone (which I am guessing is being messed about by the BS/N/CW zones, specially in the early years). Whatever the case, for now we can proceed with the eastern zone data but the rest need some clarification.

## Total Catch

Before selecting what data constitute plausible values we first need to limit the data-set to the eastern zone only. The range of effort (as hours) in the data.frame _ab_ extends from 0.0 to 1320.17 hours in a day. The latter is clearly an error and choices need to be made as to what constitutes the minimum degree of data selection that one can apply to remove implausible data. Details of how the data selection criteria were chosen are given in the supplementary material.


```{r}
# make selection using criteria described in supplementary material
pickrec2 <- which((ab$hours > 0) & (ab$hours < 12) &
                  (ab$catch > 0) & (ab$catch < 1300) &
                  (ab$cpue < 340) & (ab$cpue > 5.0) & (ab$zone == "E"))
ab1 <- droplevels(ab[pickrec2,])
ab3 <- droplevels(ab[-pickrec2,])
dim(ab1)
```

### Catch per Block


```{r fig.width=6, fig.height=7}
# tabulate blocks --------------------------
cbby <- tapply(ab1$catch,list(ab1$year,ab1$block),sum,na.rm=T)/1000
numb <- ncol(cbby)
aav <- numeric(numb)
for (i in 1:numb) aav[i] <- getaav(cbby[,i])
yrs <- as.numeric(rownames(cbby))
label <- colnames(cbby)
totC <- colSums(cbby,na.rm=TRUE)
cbz <- tapply(ab$catch,list(ab$year,ab$zone),sum,na.rm=TRUE)/1000
yrtotC <- cbz[,"E"]
parset(plots=c(5,4),margin=c(0.25,0.35,0.05,0.05))
for (i in 1:numb) {
  ymax <- getmax(cbby[,i])
  plot(yrs,cbby[,i],type="l",lwd=2,ylim=c(0,ymax),panel.first=grid(),
       ylab=label[i],xlab="")
  text(2009,0.9*ymax,round(totC[i],1),cex=0.9,pos=4)
  text(1998,0.9*ymax,round(aav[i],3),cex=0.9,pos=4)
}
ymax <- getmax(yrtotC)
plot(yrs,yrtotC,type="l",lwd=2,ylim=c(0,ymax),panel.first=grid(),
     ylab="Zone Total",xlab="")
text(2009,0.95*ymax,round(getaav(yrtotC),3),cex=0.9,pos=4)
```
Block 13 is in the south-east and block 31 in the north-east. Note well that the y-axes vary greatly between blocks; block 13 has a maximum of 500t while block 25 has a maximum of 3t. The numbers on each plot represent the annual absolute variability in catch and the total catch (tonnes) in each block. In the Zone Total plot only the aav is shown; it is the lowest of all, illustrating that the variation among blocks cancels itself out to a large degree across the zone. Across the zone the catches between years are relatively smooth though mostly declining but within some individual blocks the variation is extreme. In the northern blocks from block 23 northward, there have been extreme catch events where the catches more than doubled over very short periods followed by declines. Some blocks appear to have never recovered from such declines (26, 27, 28, and 30).In amongst these changes in catch levels there were changes to the legal minimum length which was 132mm up until 2002 when it was increased to 136mm, and then up to 138mm in 2006. The second peak of catches in block 31 was the result of a reduction in legal minimum length from 136mm to 132mm in 2010 [is the LML in block 31 still 132mm? This is another sad case akin to blocks 5 and 49!]. 

It is clear that the eastern zone fishery, with a TAC = 294t, is now highly dependent upon the productivity of the eastern part of block 13, which includes the Acteaon Islands. It is also clear that over the five year period from 2015 - 2019 the RBC has declined so that the 2019 recommended catch is only 47.6% of that in 2015 and only 24.7% of that in 2000 at the start of zonation. An examination of the standardized cpue for the eastern zone along with the associated total catch provides sufficient explanation for why such large changes occurred.


## Zone-Wide CPUE

An important factor in any abalone fishery's cpue is the collection of divers doing the fishing. If we conduct a simple linear model using log-normal residual errors on the cpue then if a diver only fishes for a single year their influence on the general trend in cpue is minimal. We can identify in how many years a diver reports catches in the eastern zone and include this for each diver in the _ab1_ data.frame.

```{r fig.width=6, fig.height=3}
# find those divers who only fished for a single year
cbd <- tapply(ab1$catch,list(ab1$diver,ab1$year),sum,na.rm=TRUE)/1000
numyr <- apply(cbd,1,countgtzero)
divers <- as.numeric(names(numyr))
numd <- length(divers)
ab1$count <- NA
for (i in 1:numd) {
  pick <- which(ab1$diver == divers[i])
  ab1$count[pick] <- numyr[i]              
}
parset()
outh <- inthist(numyr,col=2,border=3,width=0.9,xlabel="Years Fished",
                ylabel="Number of Divers",panel.first=grid())
```

Which illustrates that between 1992 to 2019, 33 divers only fished for a single year. 

We can now apply a standardization across the whole zone both with and without single year divers. As we saw in the plot of catch by block above, some blocks (15, 18, 19, 25, 26, and 30) either have some years with no catches or always have low catches, or both. These are also omitted from the whole of zone view. This means we are only considering the 13 blocks 13, 14, 16, 17, 20, 21, 22, 23, 24, 27, 28, 29, and 31.


```{r }
blk <- c(13,14,16,17,20,21,22,23,24,27,28,29,31)
pick <- which(ab1$block %in% blk)
ab2 <- droplevels(ab1[pick,])
splabel <- "Eastern Zone Blacklip" # with 83000 records this takes time
labelM <- c("year","diver","take_vessel","month","ports","block")
pick <- which (ab2$count > 1)
ab3 <- makecategorical(labelM,ab2[pick,]) # only use divers >1 year
mods <- makemodels(labelM)
model1 <- standLM(mods,ab3,splabel,console=TRUE) 
```

The optimum model is essentially coincident when all divers are used or only those who have fished for more than 1 year. This is not surprising given that removing those 33 divers only removed 219 records out of 82102 records, and only 50.57t out of 22853.14t.

```{r fig.width=6, fig.height=5}
geom <- geomean(ab2$cpue)
plotstand(model1,bars=TRUE,geo=geom,catch=yrtotC)
#lines(1992:2019,model2$Results[,model2$Optimum]*geom,lwd=1,col=5)
```

[This is an appalling plot in so many ways!!!]

From 1992 to 1998 the cpue increases and so do the catches until there was 1500t being taken from the east coast from a State-wide TAC of 2520t (which included both blacklip and greenlip), so 59.5% of the total came from east coast blacklip. Despite the use of a legal minimum length (LML) implying there would be a time-lag between taking these catches and observing their impacts, at that time this appeared to be a positive sign that the fishery was not having a serious impact on the eastern stock. With a LML of 132mm the lag was thought to be between 4 to 5 years so a positive run of seven years supported the postive view. However, from 1998 to 2002 the cpue declined 42% from an average of about 87kg/hr to only about 51kg/hr. This also led to a decline in the reported catches from 1501t down to 848t. The east and west zones were introduced in 2000 with a major objective of re-distributing catch from the east coast to the west, and the LML in the eastern zone in crease to 136mm in 2002. Zonationwas aimed at spreading the catch spatially and the increase in the LML was aimed at providing a longer refuge from fishing mortality to aid larval production.

After little improvement in cpue the eastern TAC was reduced in 2004 and was held at an average of 767t until 2007 after which it increased each year to a TAC of 887t in 2010. It should be noted that cpue between 2006 - 2008 (average ~ 85.6kg/hr) was approximately the same as between 1996 - 1998 (average ~ 87.6kg/hr) and yet average catches for the two periods were 1332.2t and 780.9t respectively (a 42% decline).

Despite the rise in cpue from 2004 to 2009, cpue dropped 25% from 92.5kg/hr to 69/8kg/hr in 2010. This was later correlated with a marine heatwave event but the reduced catches at the same cpue levels suggest that the eastern stock must also have been smaller at the same time, with consequently lower productivity, lower larval production, and presumably lowered resilience to environmental perturbations [any statement on resilience makes sense in a weight-of-evidence context but otherwise is speculation]. This conclusion is supported by the fact that following 2010 the TAC was eventually reduced to 528.5t and yet no recovery in cpue became apparent and consequently, evan relatively large declines in TAC have not yet led to significant increases in cpue.  





# Discussion

Clearly one lesson is that the scales of assessment need to be small but when matched with large scale management we can still end up with problems deriving from spatial heterogeneity in abundance and availability. 

The difference between availability and abundance in abalone needs more clarity.



# References

Haddon, M., Mayfield, S., Helidoniotis, F., Chick, R. and C. Mundy (2014) _Identification and Evaluation of Performance Indicators for Abalone Fisheries._ FRDC Final Report 2007/020. Commonwealth Scientific and Industrial Research Organisation (CSIRO), Hobart.

Haddon, M., and C. Mundy (2016) _Testing abalone empirical harvest strategies, for setting TACs and associated LMLs, that include the use of novel spatially explicit performance measures._ FRDC Final Report 2013/200. CSIRO Oceans and Atmosphere, Hobart.

Haddon, M., Mundy, C., and D. Tarbath (2008) Using an inverse-logistic model to describe growth increments of blacklip abalone (_Haliotis rubra_) in Tasmania. _Fishery Bulletin_ __106__:58–71.

Helidoniotis, F., and M. Haddon (2013) Growth Models for Fisheries: The Effect of Unbalanced Sampling Error On Model Selection, Parameter Estimation, and Biological Predictions. _Journal of Shellfish Research_ __32__:223–235.

Helidoniotis, F., and M. Haddon (2014) The effectiveness of broad-scale legal minimum lengths for protecting spawning biomass of Haliotis rubra in Tasmania. _New Zealand Journal of Marine and Freshwater Research_ __48__:70–85.

Miller, K.J., Maynard, B.T. and C.N. Mundy (2009) Genetic diversity and gene flow in collapsed and healthy abalone fisheries. _Molecular Ecology_ __18__:200–211.

# Supplementary Material

99.957 percent of all records (84101/84137) reported 12 hours or less of effort, while 99.976 percent of all records reported 1300kg or less for their catch (even though one records reported 3200kg). In addition, there were 120 records reporting 0.0 hours of effort, and 55 records (out of 84137) reported 0.0 catch. When estimating cpue these too need to be removed.


```{r fig.width=6, fig.height=4.0}
parset(plots=c(2,2),margin=c(0.3,0.35,0.05,0.1))
oute <- hist(ab$hours,breaks=30,col=2,main="hours",xlab="")
outc <- hist(ab$catch,breaks=30,col=2,main="catch",xlab="")
pick <- which(ab$hours < 12)
oute2 <- hist(ab$hours[pick],breaks=24,col=2,main="hours",xlab="")
pick <- which(ab$catch < 1300)
outc2 <- hist(ab$catch[pick],breaks=26,col=2,main="catch",xlab="")

```

```{r fig.width=5, fig.height=5.5}
pick <- which((ab$hours > 0) & (ab$hours < 12) &
              (ab$catch > 0) & (ab$catch < 1300) &
              (ab$zone == "E"))
ab1 <- ab[pick,] #
 
parset(plots=c(3,1))
outce <- hist(ab1$cpue,breaks=30,col=2,main="cpue",xlab="")
pickce <- which((ab1$cpue < 340) & (ab1$cpue > 5.0))
outce2 <- hist(ab1$cpue[pickce],breaks=30,col=2,main="cpue",xlab="")
outce3 <- hist(ab1$LnCE[pickce],breaks=30,col=2,main="log(cpue)",xlab="",xlim=c(1.5,6))
ncurv <- addnorm(outce3,ab1$LnCE[pickce])
lines(ncurv$x,ncurv$y,lwd=2,col=4)
```


Which suggests that we should be removing any cpue values > 340 kg/hr and < 5 kg/hr, a loss of 161 or 0.2% of records and 8.31t or 0.036% of the catch. 



```{r}
sumcum <- cumsum(outce3$counts)
cpue <- cbind(outce3$counts,sumcum,sumcum/tail(sumcum,1))
rownames(cpue) <- outce3$mids
colnames(cpue) <- c("count","cumsum","proportion")
round(cpue,5)
```

Suggests that 99.9786% of records are retained if we place an upper limit of 340 on the cpue, despite the maximum value reported being 780kg/hr.


A comparison of the reported total Eastern zone catch relative to the TAC indicates that the TAC is taken every year with only minor deviations. There is an average of 1.38% of the TAC not caught though the actual figure has varied from -0.024% up to 5.038%. The largest amount not taken in a year occurred in 2019 where 60t, or 5% of the TAC was not taken. 

```{r}
tottac <- read.csv(file=paste0(rawdir,"total_TAC.csv"),header=TRUE)
totC <- rowSums(cbz,na.rm=TRUE)
blTAC=tottac[,"blTAC"]
diff <- c(rep(NA,8),blTAC[9:28]-totC[9:28])
eastcat <- cbind(cbz,totC=totC,blTAC=blTAC,diff=diff,prop=100*diff/blTAC)
kable(eastcat,digits=c(3,3,3,3,3,1,3,2))
```

